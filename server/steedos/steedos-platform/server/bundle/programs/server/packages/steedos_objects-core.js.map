{"version":3,"sources":["meteor://💻app/packages/steedos_objects-core/i18n.coffee","meteor://💻app/i18n.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs.coffee","meteor://💻app/cfs/cfs.coffee","meteor://💻app/packages/steedos_objects-core/cfs/cfs_fix.coffee","meteor://💻app/cfs/cfs_fix.coffee","meteor://💻app/packages/steedos_objects-core/cfs/stores.coffee","meteor://💻app/cfs/stores.coffee"],"names":["I18n","absoluteUrl","getBrowserLocale","i18n","require","t","tr","trl","url","e","root_url","replace","Meteor","isCordova","isClient","URL","pathname","error","setOptions","purify","defaultLocale","hostUrl","TAPi18n","__original","__","key","options","locale","translated","_getLanguageFilePath","lang_tag","path","conf","cdn_path","i18n_files_route","l","window","navigator","userLanguage","language","indexOf","SimpleSchema","prototype","prefix","Template","registerHelper","args","startup","userLastLocale","Session","set","Tracker","autorun","get","setLanguage","changeLanguage","rootUrl","Steedos","setLocale","moment","user","location","reload","onChangeLocale","newLocale","$","extend","fn","dataTable","defaults","_","each","Tabular","tablesByName","table","columns","column","collName","data","collection","_name","sTitle","zeroRecords","cfs","FS","HTTP","setBaseUrl","getContentType","filename","_exp","split","pop","toLowerCase","StorageAdapter","on","storeName","fileObj","console","Collection","stores","store_name","file_store","ref","ref1","ref2","settings","store","Store","OSS","isServer","aliyun","S3","aws","STEEDOSCLOUD","steedosCloud","FileSystem","join","process","env","STEEDOS_STORAGE_DIR","fileKeyMaker","absolutePath","filenameInStore","mkdirp","month","now","year","_getInfo","name","Date","getFullYear","getMonth","resolve","sync","collectionName","_id","filter","allow","contentTypes","insert","update","remove","download","db","files","before","userId","doc"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,IAAA,EAAAC,WAAA,EAAAC,gBAAA,EAAAC,IAAA;AAAAA,OAAOC,QAAQ,sBAAR,EAAgCD,IAAvC;AACAH,OAAOI,QAAQ,eAAR,CAAP;AACA,KAACD,IAAD,GAAQA,IAAR;AAEA,KAACE,CAAD,GAAKL,KAAKK,CAAV;AAEA,KAACC,EAAD,GAAMD,CAAN;AAEA,KAACE,GAAD,GAAOF,CAAP;;AAEAJ,cAAc,UAACO,GAAD;AACb,MAAAC,CAAA,EAAAC,QAAA;;AAAA,MAAGF,GAAH;AAECA,UAAMA,IAAIG,OAAJ,CAAY,KAAZ,EAAkB,EAAlB,CAAN;ACKC;;ADJF,MAAIC,OAAOC,SAAX;AACC,WAAOD,OAAOX,WAAP,CAAmBO,GAAnB,CAAP;AADD;AAGC,QAAGI,OAAOE,QAAV;AACC;AACCJ,mBAAW,IAAIK,GAAJ,CAAQH,OAAOX,WAAP,EAAR,CAAX;;AACA,YAAGO,GAAH;AACC,iBAAOE,SAASM,QAAT,GAAoBR,GAA3B;AADD;AAGC,iBAAOE,SAASM,QAAhB;AALF;AAAA,eAAAC,KAAA;AAMMR,YAAAQ,KAAA;AACL,eAAOL,OAAOX,WAAP,CAAmBO,GAAnB,CAAP;AARF;AAAA;ACkBI,aDRHI,OAAOX,WAAP,CAAmBO,GAAnB,CCQG;ADrBL;ACuBE;AD3BW,CAAd;;AAmBAL,KAAKe,UAAL,CACC;AAAAC,UAAQ,IAAR;AACAC,iBAAe,OADf;AAEAC,WAASpB;AAFT,CADD;;AAKA,IAAG,OAAAqB,OAAA,oBAAAA,YAAA,IAAH;AACCA,UAAQC,UAAR,GAAqBD,QAAQE,EAA7B;;AAEAF,UAAQE,EAAR,GAAa,UAACC,GAAD,EAAMC,OAAN,EAAeC,MAAf;AACZ,QAAAC,UAAA;AAAAA,iBAAavB,EAAEoB,GAAF,EAAOC,OAAP,EAAgBC,MAAhB,CAAb;;AACA,QAAGC,eAAcH,GAAjB;AACC,aAAOG,UAAP;ACaE;;ADVH,WAAON,QAAQC,UAAR,CAAmBE,GAAnB,EAAwBC,OAAxB,EAAiCC,MAAjC,CAAP;AANY,GAAb;;AAQAL,UAAQO,oBAAR,GAA+B,UAACC,QAAD;AAE9B,QAAAC,IAAA;AAAAA,WAAU,KAAAC,IAAA,CAAAC,QAAA,WAAsB,KAAED,IAAF,CAAOC,QAA7B,GAA2C,KAAED,IAAF,CAAOE,gBAA5D;AACAH,WAAOA,KAAKpB,OAAL,CAAa,KAAb,EAAoB,EAApB,CAAP;;AACA,QAAGoB,KAAK,CAAL,MAAW,GAAd;AACCA,aAAO9B,cAAcU,OAAd,CAAsB,MAAtB,EAA8B,EAA9B,IAAoCoB,IAA3C;ACYE;;ADVH,WAAUA,OAAK,GAAL,GAAQD,QAAR,GAAiB,OAA3B;AAP8B,GAA/B;ACoBA;;ADXD,IAAGlB,OAAOE,QAAV;AACCZ,qBAAmB;AAClB,QAAAiC,CAAA,EAAAR,MAAA;AAAAQ,QAAIC,OAAOC,SAAP,CAAiBC,YAAjB,IAAiCF,OAAOC,SAAP,CAAiBE,QAAlD,IAA8D,IAAlE;;AACA,QAAGJ,EAAEK,OAAF,CAAU,IAAV,KAAkB,CAArB;AACCb,eAAS,OAAT;AADD;AAGCA,eAAS,OAAT;ACeE;;ADdH,WAAOA,MAAP;AANkB,GAAnB;;AAUAc,eAAaC,SAAb,CAAuBvC,IAAvB,GAA8B,UAACwC,MAAD,IAA9B;;AAGAC,WAASC,cAAT,CAAwB,GAAxB,EAA6B,UAACpB,GAAD,EAAMqB,IAAN;AAC5B,WAAOxB,QAAQE,EAAR,CAAWC,GAAX,EAAgBqB,IAAhB,CAAP;AADD;AAGAlC,SAAOmC,OAAP,CAAe;AAEd,QAAAC,cAAA;AAAAJ,aAASC,cAAT,CAAwB,GAAxB,EAA6B,UAACpB,GAAD,EAAMqB,IAAN;AAC5B,aAAOxB,QAAQE,EAAR,CAAWC,GAAX,EAAgBqB,IAAhB,CAAP;AADD;AAGAG,YAAQC,GAAR,CAAY,gBAAZ,EAA8BhD,kBAA9B;AAEAiD,YAAQC,OAAR,CAAgB;AACf,UAAGH,QAAQI,GAAR,CAAY,gBAAZ,MAAiC,OAApC;AACC,YAAG,OAAA/B,OAAA,oBAAAA,YAAA,IAAH;AACCA,kBAAQgC,WAAR,CAAoB,OAApB;ACWI;;ADVLtD,aAAKuD,cAAL,CAAoB,OAApB,EAA6B;AAACC,mBAASC,QAAQxD,WAAR;AAAV,SAA7B;AACAE,aAAKuD,SAAL,CAAe,OAAf;AACAC,eAAOhC,MAAP,CAAc,OAAd;ACcI,eDbJvB,QAAQ,QAAR,EAAkBuB,MAAlB,CAAyB,OAAzB,CCaI;ADnBL;AAQC,YAAG,OAAAL,OAAA,oBAAAA,YAAA,IAAH;AACCA,kBAAQgC,WAAR,CAAoB,IAApB;ACcI;;ADbLtD,aAAKuD,cAAL,CAAoB,IAApB,EAA0B;AAACC,mBAASC,QAAQxD,WAAR;AAAV,SAA1B;AACAE,aAAKuD,SAAL,CAAe,IAAf;AACAC,eAAOhC,MAAP,CAAc,IAAd;ACiBI,eDhBJvB,QAAQ,QAAR,EAAkBuB,MAAlB,CAAyB,IAAzB,CCgBI;AACD;AD/BL;AAeAqB,qBAAiB,IAAjB;AACAG,YAAQC,OAAR,CAAgB;AACfH,cAAQC,GAAR,CAAY,gBAAZ,EAA8B,OAA9B;ACmBG,aDlBHF,iBACGpC,OAAOgD,IAAP,KACChD,OAAOgD,IAAP,GAAcjC,MAAd,IACFsB,QAAQC,GAAR,CAAY,gBAAZ,EAA8BtC,OAAOgD,IAAP,GAAcjC,MAA5C,GACGqB,kBAAkBA,mBAAkBpC,OAAOgD,IAAP,GAAcjC,MAAlD,GACFS,OAAOyB,QAAP,CAAgBC,MAAhB,CAAuB,IAAvB,CADE,GAAH,MADA,EAGAd,iBAAiBpC,OAAOgD,IAAP,GAAcjC,MAJ7B,IAAH,MADE,GAAH,MCiBG;ADpBJ;ACsBE,WDZFxB,KAAK4D,cAAL,CAAoB,UAACC,SAAD;AAEnBC,QAAEC,MAAF,CAAS,IAAT,EAAeD,EAAEE,EAAF,CAAKC,SAAL,CAAeC,QAA9B,EACC;AAAA9B,kBACC;AAAA,qBAAkBlC,EAAE,oBAAF,CAAlB;AACA,wBAAkBA,EAAE,uBAAF,CADlB;AAEA,kBAAkBA,EAAE,iBAAF,CAFlB;AAGA,uBAAkBA,EAAE,sBAAF,CAHlB;AAIA,0BAAkBA,EAAE,yBAAF,CAJlB;AAKA,yBAAkBA,EAAE,wBAAF,CALlB;AAMA,uBAAkBA,EAAE,sBAAF,CANlB;AAOA,wBAAkBA,EAAE,uBAAF,CAPlB;AAQA,4BAAkBA,EAAE,2BAAF,CARlB;AASA,wBAAkBA,EAAE,uBAAF,CATlB;AAUA,oBAAkBA,EAAE,mBAAF,CAVlB;AAWA,yBAAkBA,EAAE,wBAAF,CAXlB;AAYA,sBACC;AAAA,qBAAcA,EAAE,2BAAF,CAAd;AACA,oBAAcA,EAAE,0BAAF,CADd;AAEA,oBAAcA,EAAE,0BAAF,CAFd;AAGA,wBAAcA,EAAE,8BAAF;AAHd,WAbD;AAiBA,kBACC;AAAA,6BAAkBA,EAAE,+BAAF,CAAlB;AACA,8BAAkBA,EAAE,gCAAF;AADlB;AAlBD;AADD,OADD;ACqCG,aDdHiE,EAAEC,IAAF,CAAOC,QAAQC,YAAf,EAA6B,UAACC,KAAD;ACexB,eDdJJ,EAAEC,IAAF,CAAOG,MAAMhD,OAAN,CAAciD,OAArB,EAA8B,UAACC,MAAD;AAC7B,cAAAC,QAAA;;AAAA,cAAI,CAACD,OAAOE,IAAR,IAAgBF,OAAOE,IAAP,KAAe,KAAnC;AACC;ACgBK;;ADfN,cAAGJ,MAAMK,UAAT;AACCF,uBAAWH,MAAMK,UAAN,CAAiBC,KAA5B;AADD;AAGCH,uBAAW,EAAX;ACiBK;;ADhBND,iBAAOK,MAAP,GAAgB5E,EAAE,KAAKwE,QAAL,GAAgB,GAAhB,GAAsBD,OAAOE,IAAP,CAAYnE,OAAZ,CAAoB,KAApB,EAA0B,GAA1B,CAAxB,CAAhB;;AACA,cAAG,CAAC+D,MAAMhD,OAAN,CAAca,QAAlB;AACCmC,kBAAMhD,OAAN,CAAca,QAAd,GAAyB,EAAzB;ACkBK;;ADjBNmC,gBAAMhD,OAAN,CAAca,QAAd,CAAuB2C,WAAvB,GAAqC7E,EAAE,iBAAF,IAAuBA,EAAEwE,QAAF,CAA5D;AAVD,UCcI;ADfL,QCcG;ADvCJ,MCYE;AD7CH;AC4FA,C;;;;;;;;;;;;ACnKD,KAACM,GAAD,GAAO,EAAP;AAEAvE,OAAOmC,OAAP,CAAe;ACCb,SDAAqC,GAAGC,IAAH,CAAQC,UAAR,CAAmB,MAAnB,CCAA;ADDF;;AAOAH,IAAII,cAAJ,GAAqB,UAACC,QAAD;AACjB,MAAAC,IAAA;;AAAAA,SAAOD,SAASE,KAAT,CAAe,GAAf,EAAoBC,GAApB,GAA0BC,WAA1B,EAAP;;AACA,MAAI,MAAMH,IAAN,KAAc,KAAlB;AACE,WAAO,aAAP;AADF,SAEK,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,qBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,4BAAP;AADG,SAEA,IAAK,MAAMA,IAAN,KAAc,MAAf,IAA2B,MAAMA,IAAN,KAAc,OAA7C;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,wBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,iBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,KAAlB;AACH,WAAO,sBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,sBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,WAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,uBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,eAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,+BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,SAAlB;AACH,WAAO,oBAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,2BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,YAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,aAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,OAAlB;AACH,WAAO,0BAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,UAAP;AADG,SAEA,IAAI,MAAMA,IAAN,KAAc,MAAlB;AACH,WAAO,iBAAP;AADG;AAGH,WAAO,0BAAP;ACDH;AD9GkB,CAArB,C;;;;;;;;;;;;AETAL,GAAGS,cAAH,CAAkBnD,SAAlB,CAA4BoD,EAA5B,CAA+B,OAA/B,EAAwC,UAACC,SAAD,EAAY9E,KAAZ,EAAmB+E,OAAnB;AACtCC,UAAQhF,KAAR,CAAc,8BAAd;AACAgF,UAAQhF,KAAR,CAAcA,KAAd;AACAgF,UAAQhF,KAAR,CAAc+E,OAAd;ACCA,SDAAC,QAAQhF,KAAR,CAAc8E,SAAd,CCAA;ADJF;AAMAX,GAAGc,UAAH,CAAcxD,SAAd,CAAwBoD,EAAxB,CAA2B,OAA3B,EAAoC,UAAC7E,KAAD,EAAQ+E,OAAR,EAAiBD,SAAjB;AAClCE,UAAQhF,KAAR,CAAc,0BAAd;AACAgF,UAAQhF,KAAR,CAAcA,KAAd;AACAgF,UAAQhF,KAAR,CAAc+E,OAAd;ACEA,SDDAC,QAAQhF,KAAR,CAAc8E,SAAd,CCCA;ADLF,G;;;;;;;;;;;;AENA,IAAAI,MAAA;AAAAA,SAAS,CAAC,SAAD,EAAY,QAAZ,EAAsB,QAAtB,EAAgC,QAAhC,EAA0C,OAA1C,CAAT;;AAEA7B,EAAEC,IAAF,CAAO4B,MAAP,EAAe,UAACC,UAAD;AACXC;AAAA,MAAAA,UAAA,EAAAC,GAAA,EAAAC,IAAA,EAAAC,IAAA;;AACA,QAAAF,MAAA1F,OAAA6F,QAAA,WAAAtB,GAAA,YAAAmB,IAA+BI,KAA/B,GAA+B,MAA/B,MAAwC,KAAxC;AACI,QAAG9F,OAAOE,QAAV;AACIuF,mBAAa,IAAIjB,GAAGuB,KAAH,CAASC,GAAb,CAAiBR,UAAjB,CAAb;AADJ,WAEK,IAAGxF,OAAOiG,QAAV;AACDR,mBAAa,IAAIjB,GAAGuB,KAAH,CAASC,GAAb,CAAiBR,UAAjB,EAA6BxF,OAAO6F,QAAP,CAAgBtB,GAAhB,CAAoB2B,MAAjD,CAAb;AAJR;AAAA,SAMK,MAAAP,OAAA3F,OAAA6F,QAAA,WAAAtB,GAAA,YAAAoB,KAA+BG,KAA/B,GAA+B,MAA/B,MAAwC,IAAxC;AACD,QAAG9F,OAAOE,QAAV;AACIuF,mBAAa,IAAIjB,GAAGuB,KAAH,CAASI,EAAb,CAAgBX,UAAhB,CAAb;AADJ,WAEK,IAAGxF,OAAOiG,QAAV;AACDR,mBAAa,IAAIjB,GAAGuB,KAAH,CAASI,EAAb,CAAgBX,UAAhB,EAA4BxF,OAAO6F,QAAP,CAAgBtB,GAAhB,CAAoB6B,GAAhD,CAAb;AAJH;AAAA,SAMA,MAAAR,OAAA5F,OAAA6F,QAAA,WAAAtB,GAAA,YAAAqB,KAA+BE,KAA/B,GAA+B,MAA/B,MAAwC,cAAxC;AACD,QAAG9F,OAAOE,QAAV;AACIuF,mBAAa,IAAIjB,GAAGuB,KAAH,CAASM,YAAb,CAA0Bb,UAA1B,CAAb;AADJ,WAEK,IAAGxF,OAAOiG,QAAV;AACDR,mBAAa,IAAIjB,GAAGuB,KAAH,CAASM,YAAb,CAA0Bb,UAA1B,EAAsCxF,OAAO6F,QAAP,CAAgBtB,GAAhB,CAAoB+B,YAA1D,CAAb;AAJH;AAAA;AAMD,QAAGtG,OAAOE,QAAV;AACIuF,mBAAa,IAAIjB,GAAGuB,KAAH,CAASQ,UAAb,CAAwBf,UAAxB,CAAb;AADJ,WAEK,IAAGxF,OAAOiG,QAAV;AACDR,mBAAa,IAAIjB,GAAGuB,KAAH,CAASQ,UAAb,CAAwBf,UAAxB,EAAoC;AACzCrE,cAAM3B,QAAQ,MAAR,EAAgBgH,IAAhB,CAAqBC,QAAQC,GAAR,CAAYC,mBAAjC,EAAsD,WAASnB,UAA/D,CADmC;AAEzCoB,sBAAc,UAACxB,OAAD;AAEV,cAAAyB,YAAA,EAAAjC,QAAA,EAAAkC,eAAA,EAAAC,MAAA,EAAAC,KAAA,EAAAC,GAAA,EAAA9F,IAAA,EAAAf,QAAA,EAAA0F,KAAA,EAAAoB,IAAA;AAAApB,kBAAQV,WAAYA,QAAQ+B,QAAR,CAAiB3B,UAAjB,CAApB;;AAEA,cAAGM,SAAUA,MAAMjF,GAAnB;AACI,mBAAOiF,MAAMjF,GAAb;ACIjB;;ADAa+D,qBAAWQ,QAAQgC,IAAR,EAAX;AACAN,4BAAkB1B,QAAQgC,IAAR,CAAa;AAACtB,mBAAON;AAAR,WAAb,CAAlB;AAEAyB,gBAAM,IAAII,IAAJ,EAAN;AACAH,iBAAOD,IAAIK,WAAJ,EAAP;AACAN,kBAAQC,IAAIM,QAAJ,KAAiB,CAAzB;AACApG,iBAAO3B,QAAQ,MAAR,CAAP;AACAuH,mBAASvH,QAAQ,QAAR,CAAT;AACAY,qBAAWe,KAAKqF,IAAL,CAAUC,QAAQC,GAAR,CAAYC,mBAAtB,EAA2C,WAASnB,UAAT,GAAoB,GAApB,GAAyB0B,IAAzB,GAAgC,GAAhC,GAAsCF,KAAjF,CAAX;AAEAH,yBAAe1F,KAAKqG,OAAL,CAAapH,QAAb,CAAf;AAEA2G,iBAAOU,IAAP,CAAYZ,YAAZ;AAGA,iBAAOK,OAAO,GAAP,GAAaF,KAAb,GAAqB,GAArB,GAA2B5B,QAAQsC,cAAnC,GAAoD,GAApD,GAA0DtC,QAAQuC,GAAlE,GAAwE,GAAxE,IAA+Eb,mBAAmBlC,QAAlG,CAAP;AA1BqC;AAAA,OAApC,CAAb;AATH;ACqCN;;ADEC,MAAGY,eAAc,QAAjB;AACIjB,QAAIiB,UAAJ,IAAkB,IAAIhB,GAAGc,UAAP,CAAkBE,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAmC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADJ,SAQK,IAAGtC,eAAc,QAAd,IAA0BA,eAAc,SAA3C;AACDjB,QAAIiB,UAAJ,IAAkB,IAAIhB,GAAGc,UAAP,CAAkBE,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAmC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADC,SAQA,IAAGtC,eAAc,QAAjB;AACDjB,QAAIiB,UAAJ,IAAkB,IAAIhB,GAAGc,UAAP,CAAkBE,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD,CAAR;AACAmC,cAAQ;AACJC,eAAO;AACHC,wBAAc,CAAC,SAAD;AADX;AADH;AADR,KADc,CAAlB;AADC;AASDvD,QAAIiB,UAAJ,IAAkB,IAAIhB,GAAGc,UAAP,CAAkBE,UAAlB,EACd;AAAAD,cAAQ,CAACE,UAAD;AAAR,KADc,CAAlB;ACKL;;ADFClB,MAAIiB,UAAJ,EAAgBqC,KAAhB,CACI;AAAAE,YAAQ;AACJ,aAAO,IAAP;AADJ;AAEAC,YAAQ;AACJ,aAAO,IAAP;AAHJ;AAIAC,YAAQ;AACJ,aAAO,IAAP;AALJ;AAMAC,cAAU;AACN,aAAO,IAAP;AAPJ;AAAA,GADJ;;AAUA,MAAG1C,eAAc,SAAjB;AACI2C,OAAG3C,UAAH,IAAiBjB,IAAIiB,UAAJ,CAAjB;AACA2C,OAAG3C,UAAH,EAAe4C,KAAf,CAAqBC,MAArB,CAA4BN,MAA5B,CAAmC,UAACO,MAAD,EAASC,GAAT;ACQrC,aDPMA,IAAID,MAAJ,GAAaA,MCOnB;ADRE;ACUL;;ADPC,MAAG9C,eAAc,OAAjB;ACSA,WDRI2C,GAAG,SAAO3C,UAAP,GAAkB,aAArB,IAAqCjB,IAAIiB,UAAJ,EAAgB4C,KCQzD;AACD;AD1GH,G","file":"/packages/steedos_objects-core.js","sourcesContent":["i18n = require('meteor/universe:i18n').i18n;\nI18n = require('@steedos/i18n');\n@i18n = i18n;\n\n@t = I18n.t\n\n@tr = t\n\n@trl = t\n\nabsoluteUrl = (url)->\n\tif url\n\t\t# url以\"/\"开头的话，去掉开头的\"/\"\n\t\turl = url.replace(/^\\//,\"\")\n\tif (Meteor.isCordova)\n\t\treturn Meteor.absoluteUrl(url);\n\telse\n\t\tif Meteor.isClient\n\t\t\ttry\n\t\t\t\troot_url = new URL(Meteor.absoluteUrl())\n\t\t\t\tif url\n\t\t\t\t\treturn root_url.pathname + url\n\t\t\t\telse\n\t\t\t\t\treturn root_url.pathname\n\t\t\tcatch e\n\t\t\t\treturn Meteor.absoluteUrl(url)\n\t\telse\n\t\t\tMeteor.absoluteUrl(url)\n# 重写tap:i18n函数，向后兼容\ni18n.setOptions\n\tpurify: null\n\tdefaultLocale: 'zh-CN'\n\thostUrl: absoluteUrl()\n\nif TAPi18n?\n\tTAPi18n.__original = TAPi18n.__\n\n\tTAPi18n.__ = (key, options, locale)->\n\t\ttranslated = t(key, options, locale);\n\t\tif translated != key\n\t\t\treturn translated\n\n\t\t# i18n 翻译不出来，尝试用 tap:i18n 翻译 TODO remove\n\t\treturn TAPi18n.__original key, options, locale\n\n\tTAPi18n._getLanguageFilePath = (lang_tag) ->\n\n\t\tpath = if @.conf.cdn_path? then @.conf.cdn_path else @.conf.i18n_files_route\n\t\tpath = path.replace /\\/$/, \"\"\n\t\tif path[0] == \"/\"\n\t\t\tpath = absoluteUrl().replace(/\\/+$/, \"\") + path\n\n\t\treturn \"#{path}/#{lang_tag}.json\"\n\nif Meteor.isClient\n\tgetBrowserLocale = ()->\n\t\tl = window.navigator.userLanguage || window.navigator.language || 'en'\n\t\tif l.indexOf(\"zh\") >=0\n\t\t\tlocale = \"zh-cn\"\n\t\telse\n\t\t\tlocale = \"en-us\"\n\t\treturn locale\n\n\n\t# 停用业务对象翻译 此函数已弃用\n\tSimpleSchema.prototype.i18n = (prefix) ->\n\t\treturn\n\n\tTemplate.registerHelper '_', (key, args)->\n\t\treturn TAPi18n.__(key, args);\n\n\tMeteor.startup ->\n\n\t\tTemplate.registerHelper '_', (key, args)->\n\t\t\treturn TAPi18n.__(key, args);\n\n\t\tSession.set(\"steedos-locale\", getBrowserLocale())\n\n\t\tTracker.autorun ()->\n\t\t\tif Session.get(\"steedos-locale\") != \"en-us\"\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"zh-CN\")\n\t\t\t\tI18n.changeLanguage(\"zh-CN\", {rootUrl: Steedos.absoluteUrl() })\n\t\t\t\ti18n.setLocale(\"zh-CN\")\n\t\t\t\tmoment.locale(\"zh-cn\")\n\t\t\t\trequire(\"moment\").locale(\"zh-cn\")\n\t\t\telse\n\t\t\t\tif TAPi18n?\n\t\t\t\t\tTAPi18n.setLanguage(\"en\")\n\t\t\t\tI18n.changeLanguage(\"en\", {rootUrl: Steedos.absoluteUrl() })\n\t\t\t\ti18n.setLocale(\"en\")\n\t\t\t\tmoment.locale(\"en\")\n\t\t\t\trequire(\"moment\").locale(\"en\")\n\t\tuserLastLocale = null\n\t\tTracker.autorun ()->\n\t\t\tSession.set(\"steedos-locale\", \"zh-CN\")\n\t\t\tuserLastLocale =\n\t\t\tif Meteor.user()\n\t\t\t\tif Meteor.user().locale\n\t\t\t\t\tSession.set(\"steedos-locale\", Meteor.user().locale);\n\t\t\t\t\tif userLastLocale && userLastLocale != Meteor.user().locale\n\t\t\t\t\t\twindow.location.reload(true);\n\t\t\t\t\tuserLastLocale = Meteor.user().locale\n\n\t\ti18n.onChangeLocale (newLocale)->\n\n\t\t\t$.extend true, $.fn.dataTable.defaults,\n\t\t\t\tlanguage:\n\t\t\t\t\t\"decimal\":        t(\"dataTables.decimal\"),\n\t\t\t\t\t\"emptyTable\":     t(\"dataTables.emptyTable\"),\n\t\t\t\t\t\"info\":           t(\"dataTables.info\"),\n\t\t\t\t\t\"infoEmpty\":      t(\"dataTables.infoEmpty\"),\n\t\t\t\t\t\"infoFiltered\":   t(\"dataTables.infoFiltered\"),\n\t\t\t\t\t\"infoPostFix\":    t(\"dataTables.infoPostFix\"),\n\t\t\t\t\t\"thousands\":      t(\"dataTables.thousands\"),\n\t\t\t\t\t\"lengthMenu\":     t(\"dataTables.lengthMenu\"),\n\t\t\t\t\t\"loadingRecords\": t(\"dataTables.loadingRecords\"),\n\t\t\t\t\t\"processing\":     t(\"dataTables.processing\"),\n\t\t\t\t\t\"search\":         t(\"dataTables.search\"),\n\t\t\t\t\t\"zeroRecords\":    t(\"dataTables.zeroRecords\"),\n\t\t\t\t\t\"paginate\":\n\t\t\t\t\t\t\"first\":      t(\"dataTables.paginate.first\"),\n\t\t\t\t\t\t\"last\":       t(\"dataTables.paginate.last\"),\n\t\t\t\t\t\t\"next\":       t(\"dataTables.paginate.next\"),\n\t\t\t\t\t\t\"previous\":   t(\"dataTables.paginate.previous\")\n\t\t\t\t\t\"aria\":\n\t\t\t\t\t\t\"sortAscending\":  t(\"dataTables.aria.sortAscending\"),\n\t\t\t\t\t\t\"sortDescending\": t(\"dataTables.aria.sortDescending\")\n\n\t\t\t_.each Tabular.tablesByName, (table) ->\n\t\t\t\t_.each table.options.columns, (column) ->\n\t\t\t\t\tif (!column.data || column.data == \"_id\")\n\t\t\t\t\t\treturn\n\t\t\t\t\tif table.collection\n\t\t\t\t\t\tcollName = table.collection._name\n\t\t\t\t\telse\n\t\t\t\t\t\tcollName = ''\n\t\t\t\t\tcolumn.sTitle = t(\"\" + collName + \"_\" + column.data.replace(/\\./g,\"_\"));\n\t\t\t\t\tif !table.options.language\n\t\t\t\t\t\ttable.options.language = {}\n\t\t\t\t\ttable.options.language.zeroRecords = t(\"dataTables.zero\") + t(collName)\n\t\t\t\t\treturn \n\n\n","var I18n, absoluteUrl, getBrowserLocale, i18n;\n\ni18n = require('meteor/universe:i18n').i18n;\n\nI18n = require('@steedos/i18n');\n\nthis.i18n = i18n;\n\nthis.t = I18n.t;\n\nthis.tr = t;\n\nthis.trl = t;\n\nabsoluteUrl = function(url) {\n  var e, root_url;\n  if (url) {\n    url = url.replace(/^\\//, \"\");\n  }\n  if (Meteor.isCordova) {\n    return Meteor.absoluteUrl(url);\n  } else {\n    if (Meteor.isClient) {\n      try {\n        root_url = new URL(Meteor.absoluteUrl());\n        if (url) {\n          return root_url.pathname + url;\n        } else {\n          return root_url.pathname;\n        }\n      } catch (error) {\n        e = error;\n        return Meteor.absoluteUrl(url);\n      }\n    } else {\n      return Meteor.absoluteUrl(url);\n    }\n  }\n};\n\ni18n.setOptions({\n  purify: null,\n  defaultLocale: 'zh-CN',\n  hostUrl: absoluteUrl()\n});\n\nif (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n  TAPi18n.__original = TAPi18n.__;\n  TAPi18n.__ = function(key, options, locale) {\n    var translated;\n    translated = t(key, options, locale);\n    if (translated !== key) {\n      return translated;\n    }\n    return TAPi18n.__original(key, options, locale);\n  };\n  TAPi18n._getLanguageFilePath = function(lang_tag) {\n    var path;\n    path = this.conf.cdn_path != null ? this.conf.cdn_path : this.conf.i18n_files_route;\n    path = path.replace(/\\/$/, \"\");\n    if (path[0] === \"/\") {\n      path = absoluteUrl().replace(/\\/+$/, \"\") + path;\n    }\n    return path + \"/\" + lang_tag + \".json\";\n  };\n}\n\nif (Meteor.isClient) {\n  getBrowserLocale = function() {\n    var l, locale;\n    l = window.navigator.userLanguage || window.navigator.language || 'en';\n    if (l.indexOf(\"zh\") >= 0) {\n      locale = \"zh-cn\";\n    } else {\n      locale = \"en-us\";\n    }\n    return locale;\n  };\n  SimpleSchema.prototype.i18n = function(prefix) {};\n  Template.registerHelper('_', function(key, args) {\n    return TAPi18n.__(key, args);\n  });\n  Meteor.startup(function() {\n    var userLastLocale;\n    Template.registerHelper('_', function(key, args) {\n      return TAPi18n.__(key, args);\n    });\n    Session.set(\"steedos-locale\", getBrowserLocale());\n    Tracker.autorun(function() {\n      if (Session.get(\"steedos-locale\") !== \"en-us\") {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"zh-CN\");\n        }\n        I18n.changeLanguage(\"zh-CN\", {\n          rootUrl: Steedos.absoluteUrl()\n        });\n        i18n.setLocale(\"zh-CN\");\n        moment.locale(\"zh-cn\");\n        return require(\"moment\").locale(\"zh-cn\");\n      } else {\n        if (typeof TAPi18n !== \"undefined\" && TAPi18n !== null) {\n          TAPi18n.setLanguage(\"en\");\n        }\n        I18n.changeLanguage(\"en\", {\n          rootUrl: Steedos.absoluteUrl()\n        });\n        i18n.setLocale(\"en\");\n        moment.locale(\"en\");\n        return require(\"moment\").locale(\"en\");\n      }\n    });\n    userLastLocale = null;\n    Tracker.autorun(function() {\n      Session.set(\"steedos-locale\", \"zh-CN\");\n      return userLastLocale = Meteor.user() ? Meteor.user().locale ? (Session.set(\"steedos-locale\", Meteor.user().locale), userLastLocale && userLastLocale !== Meteor.user().locale ? window.location.reload(true) : void 0, userLastLocale = Meteor.user().locale) : void 0 : void 0;\n    });\n    return i18n.onChangeLocale(function(newLocale) {\n      $.extend(true, $.fn.dataTable.defaults, {\n        language: {\n          \"decimal\": t(\"dataTables.decimal\"),\n          \"emptyTable\": t(\"dataTables.emptyTable\"),\n          \"info\": t(\"dataTables.info\"),\n          \"infoEmpty\": t(\"dataTables.infoEmpty\"),\n          \"infoFiltered\": t(\"dataTables.infoFiltered\"),\n          \"infoPostFix\": t(\"dataTables.infoPostFix\"),\n          \"thousands\": t(\"dataTables.thousands\"),\n          \"lengthMenu\": t(\"dataTables.lengthMenu\"),\n          \"loadingRecords\": t(\"dataTables.loadingRecords\"),\n          \"processing\": t(\"dataTables.processing\"),\n          \"search\": t(\"dataTables.search\"),\n          \"zeroRecords\": t(\"dataTables.zeroRecords\"),\n          \"paginate\": {\n            \"first\": t(\"dataTables.paginate.first\"),\n            \"last\": t(\"dataTables.paginate.last\"),\n            \"next\": t(\"dataTables.paginate.next\"),\n            \"previous\": t(\"dataTables.paginate.previous\")\n          },\n          \"aria\": {\n            \"sortAscending\": t(\"dataTables.aria.sortAscending\"),\n            \"sortDescending\": t(\"dataTables.aria.sortDescending\")\n          }\n        }\n      });\n      return _.each(Tabular.tablesByName, function(table) {\n        return _.each(table.options.columns, function(column) {\n          var collName;\n          if (!column.data || column.data === \"_id\") {\n            return;\n          }\n          if (table.collection) {\n            collName = table.collection._name;\n          } else {\n            collName = '';\n          }\n          column.sTitle = t(\"\" + collName + \"_\" + column.data.replace(/\\./g, \"_\"));\n          if (!table.options.language) {\n            table.options.language = {};\n          }\n          table.options.language.zeroRecords = t(\"dataTables.zero\") + t(collName);\n        });\n      });\n    });\n  });\n}\n","@cfs = {}\n\nMeteor.startup ->\n  FS.HTTP.setBaseUrl(\"/api\")\n\n\n# 通过文件扩展名获取文件contentType\n# http://reference.sitepoint.com/html/mime-types\n# 参照s3上传附件后的contentType\ncfs.getContentType = (filename) ->\n    _exp = filename.split('.').pop().toLowerCase()\n    if ('.' + _exp == '.au') \n      return 'audio/basic'\n    else if ('.' + _exp == '.avi') \n      return 'video/x-msvideo'\n    else if ('.' + _exp == '.bmp') \n      return 'image/bmp'\n    else if ('.' + _exp == '.bz2') \n      return 'application/x-bzip2'\n    else if ('.' + _exp == '.css') \n      return 'text/css'\n    else if ('.' + _exp == '.dtd') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.doc') \n      return 'application/msword'\n    else if ('.' + _exp == '.docx') \n      return 'application/msword'\n    else if ('.' + _exp == '.dotx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.es') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.exe') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.gif') \n      return 'image/gif'\n    else if ('.' + _exp == '.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.hqx') \n      return 'application/mac-binhex40'\n    else if ('.' + _exp == '.html') \n      return 'text/html'\n    else if ('.' + _exp == '.jar') \n      return 'application/x-java-archive'\n    else if (('.' + _exp == '.jpg') || ('.' + _exp == '.jpeg')) \n      return 'image/jpeg'\n    else if ('.' + _exp == '.js') \n      return 'application/x-javascript'\n    else if ('.' + _exp == '.jsp') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.midi') \n      return 'audio/midi'\n    else if ('.' + _exp == '.mp3') \n      return 'audio/mpeg'\n    else if ('.' + _exp == '.mpeg') \n      return 'video/mpeg'\n    else if ('.' + _exp == '.ogg') \n      return 'application/ogg'\n    else if ('.' + _exp == '.pdf') \n      return 'application/pdf'\n    else if ('.' + _exp == '.pl') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.png') \n      return 'image/png'\n    else if ('.' + _exp == '.potx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppsx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.ppt') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.pptx') \n      return 'application/vnd.ms-powerpoint'\n    else if ('.' + _exp == '.ps') \n      return 'application/postscript'\n    else if ('.' + _exp == '.qt') \n      return 'video/quicktime'\n    else if ('.' + _exp == '.ra') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.ram') \n      return 'audio/x-pn-realaudio'\n    else if ('.' + _exp == '.rdf') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.rtf') \n      return 'text/rtf'\n    else if ('.' + _exp == '.sgml') \n      return 'text/sgml'\n    else if ('.' + _exp == '.sit') \n      return 'application/x-stuffit'\n    else if ('.' + _exp == '.sldx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.svg') \n      return 'image/svg+xml'\n    else if ('.' + _exp == '.swf') \n      return 'application/x-shockwave-flash'\n    else if ('.' + _exp == '.tar.gz') \n      return 'application/x-gzip'\n    else if ('.' + _exp == '.tgz') \n      return 'application/x-compressed'\n    else if ('.' + _exp == '.tiff') \n      return 'image/tiff'\n    else if ('.' + _exp == '.tsv') \n      return 'text/tab-separated-values'\n    else if ('.' + _exp == '.txt') \n      return 'text/plain'\n    else if ('.' + _exp == '.wav') \n      return 'audio/x-wav'\n    else if ('.' + _exp == '.xlam') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xls') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xlsb') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xlsx') \n      return 'application/vnd.ms-excel'\n    else if ('.' + _exp == '.xltx') \n      return 'application/octet-stream'\n    else if ('.' + _exp == '.xml') \n      return 'text/xml'\n    else if ('.' + _exp == '.zip') \n      return 'application/zip'\n    else \n      return 'application/octet-stream'\n    \n\n\n","this.cfs = {};\n\nMeteor.startup(function() {\n  return FS.HTTP.setBaseUrl(\"/api\");\n});\n\ncfs.getContentType = function(filename) {\n  var _exp;\n  _exp = filename.split('.').pop().toLowerCase();\n  if ('.' + _exp === '.au') {\n    return 'audio/basic';\n  } else if ('.' + _exp === '.avi') {\n    return 'video/x-msvideo';\n  } else if ('.' + _exp === '.bmp') {\n    return 'image/bmp';\n  } else if ('.' + _exp === '.bz2') {\n    return 'application/x-bzip2';\n  } else if ('.' + _exp === '.css') {\n    return 'text/css';\n  } else if ('.' + _exp === '.dtd') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.doc') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.docx') {\n    return 'application/msword';\n  } else if ('.' + _exp === '.dotx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.es') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.exe') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.gif') {\n    return 'image/gif';\n  } else if ('.' + _exp === '.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.hqx') {\n    return 'application/mac-binhex40';\n  } else if ('.' + _exp === '.html') {\n    return 'text/html';\n  } else if ('.' + _exp === '.jar') {\n    return 'application/x-java-archive';\n  } else if (('.' + _exp === '.jpg') || ('.' + _exp === '.jpeg')) {\n    return 'image/jpeg';\n  } else if ('.' + _exp === '.js') {\n    return 'application/x-javascript';\n  } else if ('.' + _exp === '.jsp') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.midi') {\n    return 'audio/midi';\n  } else if ('.' + _exp === '.mp3') {\n    return 'audio/mpeg';\n  } else if ('.' + _exp === '.mpeg') {\n    return 'video/mpeg';\n  } else if ('.' + _exp === '.ogg') {\n    return 'application/ogg';\n  } else if ('.' + _exp === '.pdf') {\n    return 'application/pdf';\n  } else if ('.' + _exp === '.pl') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.png') {\n    return 'image/png';\n  } else if ('.' + _exp === '.potx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppsx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.ppt') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.pptx') {\n    return 'application/vnd.ms-powerpoint';\n  } else if ('.' + _exp === '.ps') {\n    return 'application/postscript';\n  } else if ('.' + _exp === '.qt') {\n    return 'video/quicktime';\n  } else if ('.' + _exp === '.ra') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.ram') {\n    return 'audio/x-pn-realaudio';\n  } else if ('.' + _exp === '.rdf') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.rtf') {\n    return 'text/rtf';\n  } else if ('.' + _exp === '.sgml') {\n    return 'text/sgml';\n  } else if ('.' + _exp === '.sit') {\n    return 'application/x-stuffit';\n  } else if ('.' + _exp === '.sldx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.svg') {\n    return 'image/svg+xml';\n  } else if ('.' + _exp === '.swf') {\n    return 'application/x-shockwave-flash';\n  } else if ('.' + _exp === '.tar.gz') {\n    return 'application/x-gzip';\n  } else if ('.' + _exp === '.tgz') {\n    return 'application/x-compressed';\n  } else if ('.' + _exp === '.tiff') {\n    return 'image/tiff';\n  } else if ('.' + _exp === '.tsv') {\n    return 'text/tab-separated-values';\n  } else if ('.' + _exp === '.txt') {\n    return 'text/plain';\n  } else if ('.' + _exp === '.wav') {\n    return 'audio/x-wav';\n  } else if ('.' + _exp === '.xlam') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xls') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xlsb') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xlsx') {\n    return 'application/vnd.ms-excel';\n  } else if ('.' + _exp === '.xltx') {\n    return 'application/octet-stream';\n  } else if ('.' + _exp === '.xml') {\n    return 'text/xml';\n  } else if ('.' + _exp === '.zip') {\n    return 'application/zip';\n  } else {\n    return 'application/octet-stream';\n  }\n};\n","FS.StorageAdapter.prototype.on 'error', (storeName, error, fileObj)->\n  console.error(\"FS.StorageAdapter emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)\n\nFS.Collection.prototype.on 'error', (error, fileObj, storeName)->\n  console.error(\"FS.Collection emit error\")\n  console.error(error)\n  console.error(fileObj)\n  console.error(storeName)","FS.StorageAdapter.prototype.on('error', function(storeName, error, fileObj) {\n  console.error(\"FS.StorageAdapter emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n\nFS.Collection.prototype.on('error', function(error, fileObj, storeName) {\n  console.error(\"FS.Collection emit error\");\n  console.error(error);\n  console.error(fileObj);\n  return console.error(storeName);\n});\n","stores = ['avatars', 'audios', 'images', 'videos', 'files']\n\n_.each stores, (store_name)->\n    file_store\n    if Meteor.settings.public.cfs?.store == \"OSS\"\n        if Meteor.isClient\n            file_store = new FS.Store.OSS(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.OSS store_name, Meteor.settings.cfs.aliyun\n\n    else if Meteor.settings.public.cfs?.store == \"S3\"\n        if Meteor.isClient\n            file_store = new FS.Store.S3(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.S3 store_name, Meteor.settings.cfs.aws\n\n    else if Meteor.settings.public.cfs?.store == \"STEEDOSCLOUD\"\n        if Meteor.isClient\n            file_store = new FS.Store.STEEDOSCLOUD(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.STEEDOSCLOUD store_name, Meteor.settings.cfs.steedosCloud\n    else\n        if Meteor.isClient\n            file_store = new FS.Store.FileSystem(store_name)\n        else if Meteor.isServer\n            file_store = new FS.Store.FileSystem(store_name, {\n                    path: require('path').join(process.env.STEEDOS_STORAGE_DIR, \"files/#{store_name}\"),\n                    fileKeyMaker: (fileObj)->\n                        # Lookup the copy\n                        store = fileObj and fileObj._getInfo(store_name)\n                        # If the store and key is found return the key\n                        if store and store.key\n                            return store.key\n\n                        # TO CUSTOMIZE, REPLACE CODE AFTER THIS POINT\n\n                        filename = fileObj.name();\n                        filenameInStore = fileObj.name({store: store_name})\n\n                        now = new Date\n                        year = now.getFullYear()\n                        month = now.getMonth() + 1\n                        path = require('path')\n                        mkdirp = require('mkdirp')\n                        pathname = path.join(process.env.STEEDOS_STORAGE_DIR, \"files/#{store_name}/\" + year + '/' + month)\n                        # Set absolute path\n                        absolutePath = path.resolve(pathname)\n                        # Ensure the path exists\n                        mkdirp.sync(absolutePath)\n\n                        # If no store key found we resolve / generate a key\n                        return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename)\n\n                })\n\n    if store_name == 'audios'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['audio/*'] # allow only audios in this FS.Collection\n                }\n            }\n    else if store_name == 'images' || store_name == 'avatars'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['image/*'] # allow only images in this FS.Collection\n                }\n            }\n    else if store_name == 'videos'\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store],\n            filter: {\n                allow: {\n                    contentTypes: ['video/*'] # allow only videos in this FS.Collection\n                }\n            }\n    else\n        cfs[store_name] = new FS.Collection store_name,\n            stores: [file_store]\n\n    cfs[store_name].allow\n        insert: ->\n            return true\n        update: ->\n            return true\n        remove: ->\n            return true\n        download: ->\n            return true\n\n    if store_name == 'avatars'\n        db[store_name] = cfs[store_name]\n        db[store_name].files.before.insert (userId, doc) ->\n            doc.userId = userId\n\n    if store_name == 'files'\n        db[\"cfs.#{store_name}.filerecord\"] = cfs[store_name].files","var stores;\n\nstores = ['avatars', 'audios', 'images', 'videos', 'files'];\n\n_.each(stores, function(store_name) {\n  file_store;\n  var file_store, ref, ref1, ref2;\n  if (((ref = Meteor.settings[\"public\"].cfs) != null ? ref.store : void 0) === \"OSS\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.OSS(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.OSS(store_name, Meteor.settings.cfs.aliyun);\n    }\n  } else if (((ref1 = Meteor.settings[\"public\"].cfs) != null ? ref1.store : void 0) === \"S3\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.S3(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.S3(store_name, Meteor.settings.cfs.aws);\n    }\n  } else if (((ref2 = Meteor.settings[\"public\"].cfs) != null ? ref2.store : void 0) === \"STEEDOSCLOUD\") {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.STEEDOSCLOUD(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.STEEDOSCLOUD(store_name, Meteor.settings.cfs.steedosCloud);\n    }\n  } else {\n    if (Meteor.isClient) {\n      file_store = new FS.Store.FileSystem(store_name);\n    } else if (Meteor.isServer) {\n      file_store = new FS.Store.FileSystem(store_name, {\n        path: require('path').join(process.env.STEEDOS_STORAGE_DIR, \"files/\" + store_name),\n        fileKeyMaker: function(fileObj) {\n          var absolutePath, filename, filenameInStore, mkdirp, month, now, path, pathname, store, year;\n          store = fileObj && fileObj._getInfo(store_name);\n          if (store && store.key) {\n            return store.key;\n          }\n          filename = fileObj.name();\n          filenameInStore = fileObj.name({\n            store: store_name\n          });\n          now = new Date;\n          year = now.getFullYear();\n          month = now.getMonth() + 1;\n          path = require('path');\n          mkdirp = require('mkdirp');\n          pathname = path.join(process.env.STEEDOS_STORAGE_DIR, (\"files/\" + store_name + \"/\") + year + '/' + month);\n          absolutePath = path.resolve(pathname);\n          mkdirp.sync(absolutePath);\n          return year + '/' + month + '/' + fileObj.collectionName + '-' + fileObj._id + '-' + (filenameInStore || filename);\n        }\n      });\n    }\n  }\n  if (store_name === 'audios') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['audio/*']\n        }\n      }\n    });\n  } else if (store_name === 'images' || store_name === 'avatars') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['image/*']\n        }\n      }\n    });\n  } else if (store_name === 'videos') {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store],\n      filter: {\n        allow: {\n          contentTypes: ['video/*']\n        }\n      }\n    });\n  } else {\n    cfs[store_name] = new FS.Collection(store_name, {\n      stores: [file_store]\n    });\n  }\n  cfs[store_name].allow({\n    insert: function() {\n      return true;\n    },\n    update: function() {\n      return true;\n    },\n    remove: function() {\n      return true;\n    },\n    download: function() {\n      return true;\n    }\n  });\n  if (store_name === 'avatars') {\n    db[store_name] = cfs[store_name];\n    db[store_name].files.before.insert(function(userId, doc) {\n      return doc.userId = userId;\n    });\n  }\n  if (store_name === 'files') {\n    return db[\"cfs.\" + store_name + \".filerecord\"] = cfs[store_name].files;\n  }\n});\n"]}