function module(e,t,n){"use strict";var i,a=V(e("./drop_down_editor/ui.drop_down_editor")),s,r=V(e("./editor/ui.data_expression")),o=e("../core/utils/common"),u=V(o),l=e("../core/utils/iterator"),d,h=V(e("./widget/selectors")),p,c=V(e("./widget/ui.keyboard_processor")),f=e("../core/utils/deferred"),_,b=V(e("../core/renderer")),m,g=V(e("../events/core/events_engine")),v=e("../core/utils/extend"),E=e("../ui/overlay/utils"),x,y=V(e("../core/component_registrator")),w=e("../events/utils");function V(e){return e&&e.__esModule?e:{default:e}}var B="dx-dropdownbox",S="content",D=a.default.inherit({_supportedKeys:function(){return(0,v.extend)({},this.callBase(),{tab:function(e){if(this.option("opened")){var t=this._getTabbableElements(),n=e.shiftKey?t.last():t.first();n&&g.default.trigger(n,"focus"),e.preventDefault()}}})},_getTabbableElements:function(){return this._getElements().filter(h.default.tabbable)},_getElements:function(){return(0,b.default)(this.content()).find("*")},_getAnonymousTemplateName:function(){return"content"},_getDefaultOptions:function(){return(0,v.extend)(this.callBase(),{acceptCustomValue:!1,contentTemplate:null,openOnFieldClick:!0,valueFormat:function(e){return Array.isArray(e)?e.join(", "):e}})},_initMarkup:function(){this._initDataExpressions(),this._renderSubmitElement(),this.$element().addClass("dx-dropdownbox"),this.callBase()},_renderSubmitElement:function(){this._$submitElement=(0,b.default)("<input>").attr("type","hidden").appendTo(this.$element())},_renderValue:function(){this._setSubmitValue(),this.callBase()},_setSubmitValue:function(){var e=this.option("value"),t="this"===this.option("valueExpr")?this._displayGetter(e):e;this._$submitElement.val(t)},_getSubmitElement:function(){return this._$submitElement},_renderInputValue:function(){var e=this.callBase.bind(this),t=[];if(!this._dataSource)return e(t),(new f.Deferred).resolve();var n=this._getCurrentValue(),i=u.default.ensureDefined(n,[]);i=Array.isArray(i)?i:[i];var a=(0,l.map)(i,function(e){return this._loadItem(e).always(function(n){var i=this._displayGetter(n);t.push(u.default.ensureDefined(i,e))}.bind(this))}.bind(this));return f.when.apply(this,a).always(function(){this.option("displayValue",t),e(t.length&&t)}.bind(this)).fail(e)},_loadItem:function(e){var t=new f.Deferred,n=this,i=(0,o.grep)(this.option("items")||[],function(t){return this._isValueEquals(this._valueGetter(t),e)}.bind(this))[0];return void 0!==i?t.resolve(i):this._loadValue(e).done((function(e){t.resolve(e)})).fail((function(i){n.option("acceptCustomValue")?t.resolve(e):t.reject()})),t.promise()},_updatePopupWidth:function(){this._setPopupOption("width",this.$element().outerWidth())},_popupElementTabHandler:function(e){if("tab"===(0,w.normalizeKeyName)(e)){var t=this._getTabbableElements().first().get(0),n=this._getTabbableElements().last().get(0),i=e.originalEvent.target,a=!(i!==t||!e.shift),s=!(i!==n||e.shift);(a||s)&&(this.close(),g.default.trigger(this._input(),"focus"),a&&e.originalEvent.preventDefault())}},_renderPopup:function(e){this.callBase(),this.option("focusStateEnabled")&&this._popup._keyboardProcessor.push(new c.default({element:this.content(),handler:this._popupElementTabHandler,context:this}))},_popupConfig:function(){return(0,v.extend)(this.callBase(),{width:function(){return this.$element().outerWidth()}.bind(this),height:"auto",tabIndex:-1,dragEnabled:!1,focusStateEnabled:this.option("focusStateEnabled"),maxHeight:function(){return(0,E.getElementMaxHeightByWindow)(this.$element())}.bind(this)})},_popupShownHandler:function(){this.callBase();var e=this._getTabbableElements().first();g.default.trigger(e,"focus")},_setCollectionWidgetOption:u.default.noop,_optionChanged:function(e){switch(this._dataExpressionOptionChanged(e),e.name){case"width":this.callBase(e),this._updatePopupWidth();break;case"dataSource":this._renderInputValue();break;case"displayValue":this.option("text",e.value);break;case"displayExpr":this._renderValue();break;default:this.callBase(e)}}}).include(r.default);(0,y.default)("dxDropDownBox",D),n.exports=D,n.exports.default=n.exports}

