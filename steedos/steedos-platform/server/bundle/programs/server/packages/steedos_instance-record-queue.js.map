{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:instance-record-queue/lib/common/main.js","meteor://ðŸ’»app/packages/steedos:instance-record-queue/lib/common/docs.js","meteor://ðŸ’»app/packages/steedos_instance-record-queue/server/startup.coffee","meteor://ðŸ’»app/server/startup.coffee","meteor://ðŸ’»app/packages/steedos:instance-record-queue/server/checkNpm.js"],"names":["InstanceRecordQueue","EventState","collection","db","instance_record_queue","Mongo","Collection","_validateDocument","doc","check","info","Object","sent","Match","Optional","Boolean","sending","Integer","createdAt","Date","createdBy","OneOf","String","send","options","currentUser","Meteor","isClient","userId","isServer","_","extend","test","pick","insert","startup","ref","settings","cron","instancerecordqueue_interval","Configure","sendInterval","sendBatchSize","keepDocs","checkNpmVersions","module","link","v"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,mBAAmB,GAAG,IAAIC,UAAJ,EAAtB,C;;;;;;;;;;;ACAAD,mBAAmB,CAACE,UAApB,GAAiCC,EAAE,CAACC,qBAAH,GAA2B,IAAIC,KAAK,CAACC,UAAV,CAAqB,uBAArB,CAA5D;;AAEA,IAAIC,iBAAiB,GAAG,UAASC,GAAT,EAAc;AAErCC,OAAK,CAACD,GAAD,EAAM;AACVE,QAAI,EAAEC,MADI;AAEVC,QAAI,EAAEC,KAAK,CAACC,QAAN,CAAeC,OAAf,CAFI;AAGVC,WAAO,EAAEH,KAAK,CAACC,QAAN,CAAeD,KAAK,CAACI,OAArB,CAHC;AAIVC,aAAS,EAAEC,IAJD;AAKVC,aAAS,EAAEP,KAAK,CAACQ,KAAN,CAAYC,MAAZ,EAAoB,IAApB;AALD,GAAN,CAAL;AAQA,CAVD;;AAYAtB,mBAAmB,CAACuB,IAApB,GAA2B,UAASC,OAAT,EAAkB;AAC5C,MAAIC,WAAW,GAAGC,MAAM,CAACC,QAAP,IAAmBD,MAAM,CAACE,MAA1B,IAAoCF,MAAM,CAACE,MAAP,EAApC,IAAuDF,MAAM,CAACG,QAAP,KAAoBL,OAAO,CAACJ,SAAR,IAAqB,UAAzC,CAAvD,IAA+G,IAAjI;;AACA,MAAIZ,GAAG,GAAGsB,CAAC,CAACC,MAAF,CAAS;AAClBb,aAAS,EAAE,IAAIC,IAAJ,EADO;AAElBC,aAAS,EAAEK;AAFO,GAAT,CAAV;;AAKA,MAAIZ,KAAK,CAACmB,IAAN,CAAWR,OAAX,EAAoBb,MAApB,CAAJ,EAAiC;AAChCH,OAAG,CAACE,IAAJ,GAAWoB,CAAC,CAACG,IAAF,CAAOT,OAAP,EAAgB,aAAhB,EAA+B,SAA/B,EAA0C,WAA1C,EAAuD,sBAAvD,EAA+E,WAA/E,CAAX;AACA;;AAEDhB,KAAG,CAACI,IAAJ,GAAW,KAAX;AACAJ,KAAG,CAACQ,OAAJ,GAAc,CAAd;;AAEAT,mBAAiB,CAACC,GAAD,CAAjB;;AAEA,SAAOR,mBAAmB,CAACE,UAApB,CAA+BgC,MAA/B,CAAsC1B,GAAtC,CAAP;AACA,CAjBD,C;;;;;;;;;;;;ACdAkB,OAAOS,OAAP,CAAe;AACd,MAAAC,GAAA;;AAAA,OAAAA,MAAAV,OAAAW,QAAA,CAAAC,IAAA,YAAAF,IAAyBG,4BAAzB,GAAyB,MAAzB;ACEG,WDDFvC,oBAAoBwC,SAApB,CACC;AAAAC,oBAAcf,OAAOW,QAAP,CAAgBC,IAAhB,CAAqBC,4BAAnC;AACAG,qBAAe,EADf;AAEAC,gBAAU;AAFV,KADD,CCCE;AAKD;ADRH,G;;;;;;;;;;;AEAA,IAAIC,gBAAJ;AAAqBC,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACF,kBAAgB,CAACG,CAAD,EAAG;AAACH,oBAAgB,GAACG,CAAjB;AAAmB;;AAAxC,CAAjD,EAA2F,CAA3F;AACrBH,gBAAgB,CAAC;AAChB,UAAQ;AADQ,CAAD,EAEb,+BAFa,CAAhB,C","file":"/packages/steedos_instance-record-queue.js","sourcesContent":["InstanceRecordQueue = new EventState();","InstanceRecordQueue.collection = db.instance_record_queue = new Mongo.Collection('instance_record_queue');\n\nvar _validateDocument = function(doc) {\n\n\tcheck(doc, {\n\t\tinfo: Object,\n\t\tsent: Match.Optional(Boolean),\n\t\tsending: Match.Optional(Match.Integer),\n\t\tcreatedAt: Date,\n\t\tcreatedBy: Match.OneOf(String, null)\n\t});\n\n};\n\nInstanceRecordQueue.send = function(options) {\n\tvar currentUser = Meteor.isClient && Meteor.userId && Meteor.userId() || Meteor.isServer && (options.createdBy || '<SERVER>') || null\n\tvar doc = _.extend({\n\t\tcreatedAt: new Date(),\n\t\tcreatedBy: currentUser\n\t});\n\n\tif (Match.test(options, Object)) {\n\t\tdoc.info = _.pick(options, 'instance_id', 'records', 'sync_date', 'instance_finish_date', 'step_name');\n\t}\n\n\tdoc.sent = false;\n\tdoc.sending = 0;\n\n\t_validateDocument(doc);\n\n\treturn InstanceRecordQueue.collection.insert(doc);\n};","Meteor.startup ->\n\tif Meteor.settings.cron?.instancerecordqueue_interval\n\t\tInstanceRecordQueue.Configure\n\t\t\tsendInterval: Meteor.settings.cron.instancerecordqueue_interval\n\t\t\tsendBatchSize: 10\n\t\t\tkeepDocs: true\n","Meteor.startup(function() {\n  var ref;\n  if ((ref = Meteor.settings.cron) != null ? ref.instancerecordqueue_interval : void 0) {\n    return InstanceRecordQueue.Configure({\n      sendInterval: Meteor.settings.cron.instancerecordqueue_interval,\n      sendBatchSize: 10,\n      keepDocs: true\n    });\n  }\n});\n","import { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n\t\"eval\": \"^0.1.2\"\n}, 'steedos:instance-record-queue');\n"]}