{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:meteor-fix/lib/autorun.js","meteor://ðŸ’»app/packages/steedos:meteor-fix/lib/meteor_fix.js"],"names":["Meteor","autorun","Tracker","Mongo","module","link","v","isServer","process","noDeprecation","mongoOptions","useUnifiedTopology","autoReconnect","undefined","reconnectTries","mongoOptionStr","env","MONGO_OPTIONS","jsonMongoOptions","JSON","parse","Object","assign","STEEDOS_CSFLE_MASTER_KEY","getMongoFieldEncryptionConsts","require","keyVaultNamespace","getKMSProviders","kmsProvider","encryptionOptions","useNewUrlParser","monitorCommands","autoEncryption","kmsProviders","bypassAutoEncryption","setConnectionOptions"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;AAOAA,MAAM,CAACC,OAAP,GAAiBC,OAAO,CAACD,OAAzB,C;;;;;;;;;;;ACPA,IAAIE,KAAJ;AAAUC,MAAM,CAACC,IAAP,CAAY,cAAZ,EAA2B;AAACF,OAAK,CAACG,CAAD,EAAG;AAACH,SAAK,GAACG,CAAN;AAAQ;;AAAlB,CAA3B,EAA+C,CAA/C;;AASV;AACA;AACA,IAAIN,MAAM,CAACO,QAAX,EAAqB;AACpBC,SAAO,CAACC,aAAR,GAAwB,IAAxB,CADoB,CACU;;AAC9B,MAAIC,YAAY,GAAG;AAClBC,sBAAkB,EAAE,IADF;AACQ;AAC1BC,iBAAa,EAAEC,SAFG;AAGlBC,kBAAc,EAAED;AAHE,GAAnB;AAMA,QAAME,cAAc,GAAGP,OAAO,CAACQ,GAAR,CAAYC,aAAnC;;AACA,MAAI,OAAOF,cAAP,KAA0B,WAA9B,EAA2C;AAC1C,UAAMG,gBAAgB,GAAGC,IAAI,CAACC,KAAL,CAAWL,cAAX,CAAzB;AAEAL,gBAAY,GAAGW,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBZ,YAAlB,EAAgCQ,gBAAhC,CAAf;AACA;;AAED,MAAIV,OAAO,CAACQ,GAAR,CAAYO,wBAAhB,EAA0C;AACzC,UAAM;AAAEC;AAAF,QAAoCC,OAAO,CAAC,mBAAD,CAAjD;;AACA,UAAM;AAAEC,uBAAF;AAAqBC;AAArB,QAAyCH,6BAA6B,EAA5E;AACA,UAAMI,WAAW,GAAGD,eAAe,EAAnC;AACA,UAAME,iBAAiB,GAAG;AACzBC,qBAAe,EAAE,IADQ;AAEzBnB,wBAAkB,EAAE,IAFK;AAGzBoB,qBAAe,EAAE,IAHQ;AAIzBC,oBAAc,EAAE;AACfN,yBAAiB,EAAEA,iBADJ;AAEfO,oBAAY,EAAEL,WAFC;AAGfM,4BAAoB,EAAE;AAHP;AAJS,KAA1B;AAUAxB,gBAAY,GAAGW,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBZ,YAAlB,EAAgCmB,iBAAhC,CAAf;AACA;;AAED1B,OAAK,CAACgC,oBAAN,CAA2BzB,YAA3B;AACA,C","file":"/packages/steedos_meteor-fix.js","sourcesContent":["/*\n * @Author: baozhoutao@steedos.com\n * @Date: 2022-06-11 09:29:42\n * @LastEditors: baozhoutao@steedos.com\n * @LastEditTime: 2022-06-11 09:29:48\n * @Description: \n */\nMeteor.autorun = Tracker.autorun","/*\n * @Author: sunhaolin@hotoa.com\n * @Date: 2021-05-24 12:32:56\n * @LastEditors: sunhaolin@hotoa.com\n * @LastEditTime: 2022-06-21 15:33:53\n * @Description: \n */\nimport { Mongo } from 'meteor/mongo'\n\n// Revert change from Meteor 1.6.1 who set ignoreUndefined: true\n// more information https://github.com/meteor/meteor/pull/9444\nif (Meteor.isServer) {\n\tprocess.noDeprecation = true; // silence deprecation warnings, ç›¸å½“äºŽ --no-deprecation\n\tlet mongoOptions = {\n\t\tuseUnifiedTopology: true, // Required to silence deprecation warnings\n\t\tautoReconnect: undefined,\n\t\treconnectTries: undefined\n\t};\n\n\tconst mongoOptionStr = process.env.MONGO_OPTIONS;\n\tif (typeof mongoOptionStr !== 'undefined') {\n\t\tconst jsonMongoOptions = JSON.parse(mongoOptionStr);\n\n\t\tmongoOptions = Object.assign({}, mongoOptions, jsonMongoOptions);\n\t}\n\n\tif (process.env.STEEDOS_CSFLE_MASTER_KEY) {\n\t\tconst { getMongoFieldEncryptionConsts } = require('@steedos/objectql');\n\t\tconst { keyVaultNamespace, getKMSProviders } = getMongoFieldEncryptionConsts();\n\t\tconst kmsProvider = getKMSProviders();\n\t\tconst encryptionOptions = {\n\t\t\tuseNewUrlParser: true,\n\t\t\tuseUnifiedTopology: true,\n\t\t\tmonitorCommands: true,\n\t\t\tautoEncryption: {\n\t\t\t\tkeyVaultNamespace: keyVaultNamespace,\n\t\t\t\tkmsProviders: kmsProvider,\n\t\t\t\tbypassAutoEncryption: true,\n\t\t\t}\n\t\t}\n\t\tmongoOptions = Object.assign({}, mongoOptions, encryptionOptions);\n\t}\n\n\tMongo.setConnectionOptions(mongoOptions);\n}\n"]}