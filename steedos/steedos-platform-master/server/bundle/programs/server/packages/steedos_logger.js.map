{"version":3,"sources":["meteor://💻app/packages/steedos:logger/checkNpm.js","meteor://💻app/packages/steedos_logger/server.coffee","meteor://💻app/server.coffee"],"names":["checkNpmVersions","module","link","v","require","StdOut","canDefineNonEnumerableProperties","chalk","processString","sanitizeEasy","sanitizeHard","extend","child","parent","key","hasProp","call","ctor","constructor","prototype","__super__","hasOwnProperty","slice","enabled","e","k","testObj","testPropName","Object","defineProperty","enumerable","value","error","obj","i","keyCount","keys","newObj","Array","isArray","length","meteorBabelHelpers","sanitizeForInObject","_sanitizeForInObjectHard","LoggerManager","superClass","_Class","loggers","queue","showPackage","showFileAndLine","logLevel","register","logger","Logger","name","emit","addToQueue","args","push","dispatchQueue","item","j","len1","ref","_log","apply","clearQueue","disable","enable","EventEmitter","defaultTypes","debug","color","level","log","info","success","warn","name1","config","fn","fn1","fn2","method","ref1","ref2","section","self","type","typeConfig","_","arguments","__section","box","methods","sections","fn3","ref3","ref4","results","_this","getPrefix","options","detailParts","details","prefix","_getCallerDetails","file","line","join","getStack","index","lines","match","packageMatch","stack","err","Error","split","exec","makeABox","message","title","l","len","len2","separator","topLine","Math","max","s","pad","lrpad","rpad","subPrefix","isString","console","unshift","SystemLogger","startup","string","date","Log","format","EJSON","parse","time","write","process","stdout","encoding","fd","viewLimit","Date","id","Random","ts","Meteor","settings","shift","publish","user","userId","ready","db","users","findOne","fields","is_cloudadmin","added","on","ref5","ref6","ref7"],"mappings":"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","file":"/packages/steedos_logger.js","sourcesContent":["// fix warning: xxx not installed\nrequire(\"chalk/package.json\");\n\nimport { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n\t'chalk': '^2.4.2'\n}, 'steedos:logger');","chalk = require(\"chalk\")\nchalk.enabled = true;\ncanDefineNonEnumerableProperties = ->\n\ttestObj = {}\n\ttestPropName = 't'\n\ttry\n\t\tObject.defineProperty testObj, testPropName,\n\t\t\tenumerable: false\n\t\t\tvalue: testObj\n\t\tfor k of testObj\n\t\t\tif k == testPropName\n\t\t\t\treturn false\n\tcatch e\n\t\treturn false\n\ttestObj[testPropName] == testObj\n\nsanitizeEasy = (value) ->\n\tvalue\n\nsanitizeHard = (obj) ->\n\tif Array.isArray(obj)\n\t\tnewObj = {}\n\t\tkeys = Object.keys(obj)\n\t\tkeyCount = keys.length\n\t\ti = 0\n\t\twhile i < keyCount\n\t\t\tkey = keys[i]\n\t\t\tnewObj[key] = obj[key]\n\t\t\t++i\n\t\treturn newObj\n\tobj\n\n@meteorBabelHelpers =\n\tsanitizeForInObject: if canDefineNonEnumerableProperties() then sanitizeEasy else sanitizeHard\n\t_sanitizeForInObjectHard: sanitizeHard\n@LoggerManager = new class extends EventEmitter\n\tconstructor: ->\n\t\t@enabled = false\n\t\t@loggers = {}\n\t\t@queue = []\n\n\t\t@showPackage = false\n\t\t@showFileAndLine = false\n\t\t@logLevel = 0\n\n\tregister: (logger) ->\n\t\tif not logger instanceof Logger\n\t\t\treturn\n\n\t\t@loggers[logger.name] = logger\n\n\t\t@emit 'register', logger\n\n\taddToQueue: (logger, args)->\n\t\t@queue.push\n\t\t\tlogger: logger\n\t\t\targs: args\n\n\tdispatchQueue: ->\n\t\tfor item in @queue\n\t\t\titem.logger._log.apply item.logger, item.args\n\n\t\t@clearQueue()\n\n\tclearQueue: ->\n\t\t@queue = []\n\n\tdisable: ->\n\t\t@enabled = false\n\n\tenable: (dispatchQueue=false) ->\n\t\t@enabled = true\n\t\tif dispatchQueue is true\n\t\t\t@dispatchQueue()\n\t\telse\n\t\t\t@clearQueue()\n\n\n# @LoggerManager.on 'register', ->\n# \tconsole.log('on register', arguments)\n\n\n@Logger = class Logger\n\tdefaultTypes:\n\t\tdebug:\n\t\t\tname: 'debug'\n\t\t\tcolor: 'blue'\n\t\t\tlevel: 2\n\t\tlog:\n\t\t\tname: 'info'\n\t\t\tcolor: 'blue'\n\t\t\tlevel: 1\n\t\tinfo:\n\t\t\tname: 'info'\n\t\t\tcolor: 'blue'\n\t\t\tlevel: 1\n\t\tsuccess:\n\t\t\tname: 'info'\n\t\t\tcolor: 'green'\n\t\t\tlevel: 1\n\t\twarn:\n\t\t\tname: 'warn'\n\t\t\tcolor: 'magenta'\n\t\t\tlevel: 1\n\t\terror:\n\t\t\tname: 'error'\n\t\t\tcolor: 'red'\n\t\t\tlevel: 0\n\n\tconstructor: (@name, config={}) ->\n\t\tself = @\n\t\t@config = {}\n\n\t\t_.extend @config, config\n\n\t\tif LoggerManager.loggers[@name]?\n\t\t\tLoggerManager.loggers[@name].warn 'Duplicated instance'\n\t\t\treturn LoggerManager.loggers[@name]\n\n\t\tfor type, typeConfig of @defaultTypes\n\t\t\tdo (type, typeConfig) ->\n\t\t\t\tself[type] = (args...) ->\n\t\t\t\t\tself._log.call self,\n\t\t\t\t\t\tsection: this.__section\n\t\t\t\t\t\ttype: type\n\t\t\t\t\t\tlevel: typeConfig.level\n\t\t\t\t\t\tmethod: typeConfig.name\n\t\t\t\t\t\targuments: args\n\n\t\t\t\tself[type+\"_box\"] = (args...) ->\n\t\t\t\t\tself._log.call self,\n\t\t\t\t\t\tsection: this.__section\n\t\t\t\t\t\ttype: type\n\t\t\t\t\t\tbox: true\n\t\t\t\t\t\tlevel: typeConfig.level\n\t\t\t\t\t\tmethod: typeConfig.name\n\t\t\t\t\t\targuments: args\n\n\t\tif @config.methods?\n\t\t\tfor method, typeConfig of @config.methods\n\t\t\t\tdo (method, typeConfig) ->\n\t\t\t\t\tif self[method]?\n\t\t\t\t\t\tself.warn \"Method\", method, \"already exists\"\n\n\t\t\t\t\tif not self.defaultTypes[typeConfig.type]?\n\t\t\t\t\t\tself.warn \"Method type\", typeConfig.type, \"does not exist\"\n\n\t\t\t\t\tself[method] = (args...) ->\n\t\t\t\t\t\tself._log.call self,\n\t\t\t\t\t\t\tsection: this.__section\n\t\t\t\t\t\t\ttype: typeConfig.type\n\t\t\t\t\t\t\tlevel: if typeConfig.level? then typeConfig.level else self.defaultTypes[typeConfig.type]?.level\n\t\t\t\t\t\t\tmethod: method\n\t\t\t\t\t\t\targuments: args\n\n\t\t\t\t\tself[method+\"_box\"] = (args...) ->\n\t\t\t\t\t\tself._log.call self,\n\t\t\t\t\t\t\tsection: this.__section\n\t\t\t\t\t\t\ttype: typeConfig.type\n\t\t\t\t\t\t\tbox: true\n\t\t\t\t\t\t\tlevel: if typeConfig.level? then typeConfig.level else self.defaultTypes[typeConfig.type]?.level\n\t\t\t\t\t\t\tmethod: method\n\t\t\t\t\t\t\targuments: args\n\n\t\tif @config.sections?\n\t\t\tfor section, name of @config.sections\n\t\t\t\tdo (section, name) ->\n\t\t\t\t\tself[section] = {}\n\t\t\t\t\tfor type, typeConfig of self.defaultTypes\n\t\t\t\t\t\tdo (type, typeConfig) =>\n\t\t\t\t\t\t\tself[section][type] = =>\n\t\t\t\t\t\t\t\tself[type].apply {__section: name}, arguments\n\n\t\t\t\t\t\t\tself[section][type+\"_box\"] = =>\n\t\t\t\t\t\t\t\tself[type+\"_box\"].apply {__section: name}, arguments\n\n\t\t\t\t\tfor method, typeConfig of self.config.methods\n\t\t\t\t\t\tdo (method, typeConfig) =>\n\t\t\t\t\t\t\tself[section][method] = =>\n\t\t\t\t\t\t\t\tself[method].apply {__section: name}, arguments\n\n\t\t\t\t\t\t\tself[section][method+\"_box\"] = =>\n\t\t\t\t\t\t\t\tself[method+\"_box\"].apply {__section: name}, arguments\n\n\t\tLoggerManager.register @\n\t\treturn @\n\n\tgetPrefix: (options) ->\n\t\tif options.section?\n\t\t\tprefix = \"#{@name} ➔ #{options.section}.#{options.method}\"\n\t\telse\n\t\t\tprefix = \"#{@name} ➔ #{options.method}\"\n\n\t\tdetails = @_getCallerDetails()\n\n\t\tdetailParts = []\n\t\tif details.package? and (LoggerManager.showPackage is true or options.type is 'error')\n\t\t\tdetailParts.push details.package\n\n\t\tif LoggerManager.showFileAndLine is true or options.type is 'error'\n\t\t\tif details.file? and details.line?\n\t\t\t\tdetailParts.push \"#{details.file}:#{details.line}\"\n\t\t\telse\n\t\t\t\tif details.file?\n\t\t\t\t\tdetailParts.push details.file\n\t\t\t\tif details.line?\n\t\t\t\t\tdetailParts.push details.line\n\n\t\tif @defaultTypes[options.type]?\n#\t\t\tprefix = prefix[@defaultTypes[options.type].color] 由于colors 包的问题，服务端暂时不支持log color 显示\n\t\t\tprefix = chalk[@defaultTypes[options.type].color](prefix)\n\n\t\tif detailParts.length > 0\n\t\t\tprefix = \"#{detailParts.join(' ')} #{prefix}\"\n\n\t\treturn prefix\n\n\t# @returns {Object: { line: Number, file: String }}\n\t_getCallerDetails: ->\n\t\tgetStack = () ->\n\t\t\t# We do NOT use Error.prepareStackTrace here (a V8 extension that gets us a\n\t\t\t# pre-parsed stack) since it's impossible to compose it with the use of\n\t\t\t# Error.prepareStackTrace used on the server for source maps.\n\t\t\terr = new Error\n\t\t\tstack = err.stack\n\t\t\treturn stack\n\n\t\tstack = getStack()\n\n\t\tif not stack\n\t\t\treturn {}\n\n\t\tlines = stack.split('\\n')\n\n\t\t# looking for the first line outside the logging package (or an\n\t\t# eval if we find that first)\n\t\tline = undefined\n\t\tfor item, index in lines when index > 0\n\t\t\tline = item\n\t\t\tif line.match(/^\\s*at eval \\(eval/)\n\t\t\t\treturn {file: \"eval\"}\n\n\t\t\tif not line.match(/packages\\/rocketchat_logger(?:\\/|\\.js)/)\n\t\t\t\tbreak\n\n\t\tdetails = {}\n\n\t\t# The format for FF is 'functionName@filePath:lineNumber'\n\t\t# The format for V8 is 'functionName (packages/logging/logging.js:81)' or\n\t\t#                      'packages/logging/logging.js:81'\n\t\tmatch = /(?:[@(]| at )([^(]+?):([0-9:]+)(?:\\)|$)/.exec(line)\n\t\tif not match\n\t\t\treturn details\n\t\t# in case the matched block here is line:column\n\t\tdetails.line = match[2].split(':')[0]\n\n\t\t# Possible format: https://foo.bar.com/scripts/file.js?random=foobar\n\t\t# XXX: if you can write the following in better way, please do it\n\t\t# XXX: what about evals?\n\t\tdetails.file = match[1].split('/').slice(-1)[0].split('?')[0]\n\n\t\tpackageMatch = match[1].match(/packages\\/([^\\.\\/]+)(?:\\/|\\.)/)\n\t\tif packageMatch?\n\t\t\tdetails.package = packageMatch[1]\n\n\t\treturn details\n\n\tmakeABox: (message, title) ->\n\t\tif not _.isArray(message)\n\t\t\tmessage = message.split(\"\\n\")\n\n\t\tlen = 0\n\t\tfor line in message\n\t\t\tlen = Math.max(len, line.length)\n\n\t\ttopLine = \"+--\" + s.pad('', len, '-') + \"--+\"\n\t\tseparator = \"|  \" + s.pad('', len, '') + \"  |\"\n\t\tlines = []\n\n\t\tlines.push topLine\n\t\tif title?\n\t\t\tlines.push \"|  \" + s.lrpad(title, len) + \"  |\"\n\t\t\tlines.push topLine\n\n\t\tlines.push separator\n\n\t\tfor line in message\n\t\t\tlines.push \"|  \" + s.rpad(line, len) + \"  |\"\n\n\t\tlines.push separator\n\t\tlines.push topLine\n\t\treturn lines\n\n\n\t_log: (options) ->\n\t\tif LoggerManager.enabled is false\n\t\t\tLoggerManager.addToQueue @, arguments\n\t\t\treturn\n\n\t\toptions.level ?= 1\n\n\t\tif LoggerManager.logLevel < options.level\n\t\t\treturn\n\n\t\tprefix = @getPrefix(options)\n\n\t\tif options.box is true and _.isString(options.arguments[0])\n\t\t\tcolor = undefined\n\t\t\tif @defaultTypes[options.type]?\n\t\t\t\tcolor = @defaultTypes[options.type].color\n\n\t\t\tbox = @makeABox options.arguments[0], options.arguments[1]\n\t\t\tsubPrefix = '➔'\n\t\t\tif color?\n\t\t\t\tsubPrefix = subPrefix[color]\n\n\t\t\tconsole.log subPrefix, prefix\n\t\t\tfor line in box\n\t\t\t\tif color?\n\t\t\t\t\tconsole.log subPrefix, line[color]\n\t\t\t\telse\n\t\t\t\t\tconsole.log subPrefix, line\n\t\telse\n\t\t\toptions.arguments.unshift prefix\n\t\t\tconsole.log.apply console, options.arguments\n\n\t\treturn\n\n\n@SystemLogger = new Logger 'System',\n\tmethods:\n\t\tstartup:\n\t\t\ttype: 'success'\n\t\t\tlevel: 0\n\nprocessString = (string, date) ->\n\tif string[0] is '{'\n\t\ttry\n\t\t\treturn Log.format EJSON.parse(string), {color: true}\n\n\ttry\n\t\treturn Log.format {message: string, time: date, level: 'info'}, {color: true}\n\n\treturn string\n\nStdOut = new class extends EventEmitter\n\tconstructor: ->\n\t\t@queue = []\n\t\twrite = process.stdout.write\n\t\tprocess.stdout.write = (string, encoding, fd) =>\n\t\t\twrite.apply(process.stdout, arguments)\n\t\t\tdate = new Date\n\t\t\tstring = processString string, date\n\n\t\t\titem =\n\t\t\t\tid: Random.id()\n\t\t\t\tstring: string\n\t\t\t\tts: date\n\n\t\t\t@queue.push item\n\n\t\t\t# if RocketChat?.settings?.get('Log_View_Limit')? and @queue.length > RocketChat.settings.get('Log_View_Limit')\n\t\t\t# \t@queue.shift()\n\n\t\t\tviewLimit = Meteor.settings?.logger?.viewLimit\n\t\t\tunless viewLimit\n\t\t\t\tviewLimit = 1000\n\t\t\tif @queue.length > viewLimit\n\t\t\t\t@queue.shift()\n\n\t\t\t@emit 'write', string, item\n\n\nMeteor.publish 'stdout', ->\n\tunless @userId\n\t\treturn @ready()\n\n\t# if RocketChat.authz.hasPermission(@userId, 'view-logs') isnt true\n\t# \treturn @ready()\n\n\tunless @userId\n\t\treturn @ready()\n\n\tuser = db.users.findOne(@userId, {fields: {is_cloudadmin: 1}})\n\n\tunless user\n\t\treturn @ready()\n\n\tfor item in StdOut.queue\n\t\t@added 'stdout', item.id,\n\t\t\tstring: item.string\n\t\t\tts: item.ts\n\n\t@ready()\n\n\tStdOut.on 'write', (string, item) =>\n\t\t@added 'stdout', item.id,\n\t\t\tstring: item.string\n\t\t\tts: item.ts\n\n\treturn\n\nMeteor.startup ->\n\tif Meteor.settings?.logger?.enabled\n\t\tif Meteor.settings?.logger?.showPackage\n\t\t\tLoggerManager.showPackage = true;\n\t\tif Meteor.settings?.logger?.showFileAndLine\n\t\t\tLoggerManager.showFileAndLine = true;\n\t\tif Meteor.settings?.logger?.logLevel\n\t\t\tLoggerManager.logLevel = Meteor.settings.logger.logLevel;\n\n\t\tLoggerManager.enable(true);\n\n","var StdOut, canDefineNonEnumerableProperties, chalk, processString, sanitizeEasy, sanitizeHard,        \n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty,\n  slice = [].slice;\n\nchalk = require(\"chalk\");\n\nchalk.enabled = true;\n\ncanDefineNonEnumerableProperties = function() {\n  var e, k, testObj, testPropName;\n  testObj = {};\n  testPropName = 't';\n  try {\n    Object.defineProperty(testObj, testPropName, {\n      enumerable: false,\n      value: testObj\n    });\n    for (k in testObj) {\n      if (k === testPropName) {\n        return false;\n      }\n    }\n  } catch (error) {\n    e = error;\n    return false;\n  }\n  return testObj[testPropName] === testObj;\n};\n\nsanitizeEasy = function(value) {\n  return value;\n};\n\nsanitizeHard = function(obj) {\n  var i, key, keyCount, keys, newObj;\n  if (Array.isArray(obj)) {\n    newObj = {};\n    keys = Object.keys(obj);\n    keyCount = keys.length;\n    i = 0;\n    while (i < keyCount) {\n      key = keys[i];\n      newObj[key] = obj[key];\n      ++i;\n    }\n    return newObj;\n  }\n  return obj;\n};\n\nthis.meteorBabelHelpers = {\n  sanitizeForInObject: canDefineNonEnumerableProperties() ? sanitizeEasy : sanitizeHard,\n  _sanitizeForInObjectHard: sanitizeHard\n};\n\nthis.LoggerManager = new ((function(superClass) {\n  extend(_Class, superClass);\n\n  function _Class() {\n    this.enabled = false;\n    this.loggers = {};\n    this.queue = [];\n    this.showPackage = false;\n    this.showFileAndLine = false;\n    this.logLevel = 0;\n  }\n\n  _Class.prototype.register = function(logger) {\n    if (!logger instanceof Logger) {\n      return;\n    }\n    this.loggers[logger.name] = logger;\n    return this.emit('register', logger);\n  };\n\n  _Class.prototype.addToQueue = function(logger, args) {\n    return this.queue.push({\n      logger: logger,\n      args: args\n    });\n  };\n\n  _Class.prototype.dispatchQueue = function() {\n    var item, j, len1, ref;\n    ref = this.queue;\n    for (j = 0, len1 = ref.length; j < len1; j++) {\n      item = ref[j];\n      item.logger._log.apply(item.logger, item.args);\n    }\n    return this.clearQueue();\n  };\n\n  _Class.prototype.clearQueue = function() {\n    return this.queue = [];\n  };\n\n  _Class.prototype.disable = function() {\n    return this.enabled = false;\n  };\n\n  _Class.prototype.enable = function(dispatchQueue) {\n    if (dispatchQueue == null) {\n      dispatchQueue = false;\n    }\n    this.enabled = true;\n    if (dispatchQueue === true) {\n      return this.dispatchQueue();\n    } else {\n      return this.clearQueue();\n    }\n  };\n\n  return _Class;\n\n})(EventEmitter));\n\nthis.Logger = Logger = (function() {\n  Logger.prototype.defaultTypes = {\n    debug: {\n      name: 'debug',\n      color: 'blue',\n      level: 2\n    },\n    log: {\n      name: 'info',\n      color: 'blue',\n      level: 1\n    },\n    info: {\n      name: 'info',\n      color: 'blue',\n      level: 1\n    },\n    success: {\n      name: 'info',\n      color: 'green',\n      level: 1\n    },\n    warn: {\n      name: 'warn',\n      color: 'magenta',\n      level: 1\n    },\n    error: {\n      name: 'error',\n      color: 'red',\n      level: 0\n    }\n  };\n\n  function Logger(name1, config) {\n    var fn, fn1, fn2, method, name, ref, ref1, ref2, section, self, type, typeConfig;\n    this.name = name1;\n    if (config == null) {\n      config = {};\n    }\n    self = this;\n    this.config = {};\n    _.extend(this.config, config);\n    if (LoggerManager.loggers[this.name] != null) {\n      LoggerManager.loggers[this.name].warn('Duplicated instance');\n      return LoggerManager.loggers[this.name];\n    }\n    ref = this.defaultTypes;\n    fn = function(type, typeConfig) {\n      self[type] = function() {\n        var args;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        return self._log.call(self, {\n          section: this.__section,\n          type: type,\n          level: typeConfig.level,\n          method: typeConfig.name,\n          \"arguments\": args\n        });\n      };\n      return self[type + \"_box\"] = function() {\n        var args;\n        args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n        return self._log.call(self, {\n          section: this.__section,\n          type: type,\n          box: true,\n          level: typeConfig.level,\n          method: typeConfig.name,\n          \"arguments\": args\n        });\n      };\n    };\n    for (type in ref) {\n      typeConfig = ref[type];\n      fn(type, typeConfig);\n    }\n    if (this.config.methods != null) {\n      ref1 = this.config.methods;\n      fn1 = function(method, typeConfig) {\n        if (self[method] != null) {\n          self.warn(\"Method\", method, \"already exists\");\n        }\n        if (self.defaultTypes[typeConfig.type] == null) {\n          self.warn(\"Method type\", typeConfig.type, \"does not exist\");\n        }\n        self[method] = function() {\n          var args, ref2;\n          args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          return self._log.call(self, {\n            section: this.__section,\n            type: typeConfig.type,\n            level: typeConfig.level != null ? typeConfig.level : (ref2 = self.defaultTypes[typeConfig.type]) != null ? ref2.level : void 0,\n            method: method,\n            \"arguments\": args\n          });\n        };\n        return self[method + \"_box\"] = function() {\n          var args, ref2;\n          args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          return self._log.call(self, {\n            section: this.__section,\n            type: typeConfig.type,\n            box: true,\n            level: typeConfig.level != null ? typeConfig.level : (ref2 = self.defaultTypes[typeConfig.type]) != null ? ref2.level : void 0,\n            method: method,\n            \"arguments\": args\n          });\n        };\n      };\n      for (method in ref1) {\n        typeConfig = ref1[method];\n        fn1(method, typeConfig);\n      }\n    }\n    if (this.config.sections != null) {\n      ref2 = this.config.sections;\n      fn2 = function(section, name) {\n        var fn3, ref3, ref4, results;\n        self[section] = {};\n        ref3 = self.defaultTypes;\n        fn3 = (function(_this) {\n          return function(type, typeConfig) {\n            self[section][type] = function() {\n              return self[type].apply({\n                __section: name\n              }, arguments);\n            };\n            return self[section][type + \"_box\"] = function() {\n              return self[type + \"_box\"].apply({\n                __section: name\n              }, arguments);\n            };\n          };\n        })(this);\n        for (type in ref3) {\n          typeConfig = ref3[type];\n          fn3(type, typeConfig);\n        }\n        ref4 = self.config.methods;\n        results = [];\n        for (method in ref4) {\n          typeConfig = ref4[method];\n          results.push((function(_this) {\n            return function(method, typeConfig) {\n              self[section][method] = function() {\n                return self[method].apply({\n                  __section: name\n                }, arguments);\n              };\n              return self[section][method + \"_box\"] = function() {\n                return self[method + \"_box\"].apply({\n                  __section: name\n                }, arguments);\n              };\n            };\n          })(this)(method, typeConfig));\n        }\n        return results;\n      };\n      for (section in ref2) {\n        name = ref2[section];\n        fn2(section, name);\n      }\n    }\n    LoggerManager.register(this);\n    return this;\n  }\n\n  Logger.prototype.getPrefix = function(options) {\n    var detailParts, details, prefix;\n    if (options.section != null) {\n      prefix = this.name + \" ➔ \" + options.section + \".\" + options.method;\n    } else {\n      prefix = this.name + \" ➔ \" + options.method;\n    }\n    details = this._getCallerDetails();\n    detailParts = [];\n    if ((details[\"package\"] != null) && (LoggerManager.showPackage === true || options.type === 'error')) {\n      detailParts.push(details[\"package\"]);\n    }\n    if (LoggerManager.showFileAndLine === true || options.type === 'error') {\n      if ((details.file != null) && (details.line != null)) {\n        detailParts.push(details.file + \":\" + details.line);\n      } else {\n        if (details.file != null) {\n          detailParts.push(details.file);\n        }\n        if (details.line != null) {\n          detailParts.push(details.line);\n        }\n      }\n    }\n    if (this.defaultTypes[options.type] != null) {\n      prefix = chalk[this.defaultTypes[options.type].color](prefix);\n    }\n    if (detailParts.length > 0) {\n      prefix = (detailParts.join(' ')) + \" \" + prefix;\n    }\n    return prefix;\n  };\n\n  Logger.prototype._getCallerDetails = function() {\n    var details, getStack, index, item, j, len1, line, lines, match, packageMatch, stack;\n    getStack = function() {\n      var err, stack;\n      err = new Error;\n      stack = err.stack;\n      return stack;\n    };\n    stack = getStack();\n    if (!stack) {\n      return {};\n    }\n    lines = stack.split('\\n');\n    line = void 0;\n    for (index = j = 0, len1 = lines.length; j < len1; index = ++j) {\n      item = lines[index];\n      if (!(index > 0)) {\n        continue;\n      }\n      line = item;\n      if (line.match(/^\\s*at eval \\(eval/)) {\n        return {\n          file: \"eval\"\n        };\n      }\n      if (!line.match(/packages\\/rocketchat_logger(?:\\/|\\.js)/)) {\n        break;\n      }\n    }\n    details = {};\n    match = /(?:[@(]| at )([^(]+?):([0-9:]+)(?:\\)|$)/.exec(line);\n    if (!match) {\n      return details;\n    }\n    details.line = match[2].split(':')[0];\n    details.file = match[1].split('/').slice(-1)[0].split('?')[0];\n    packageMatch = match[1].match(/packages\\/([^\\.\\/]+)(?:\\/|\\.)/);\n    if (packageMatch != null) {\n      details[\"package\"] = packageMatch[1];\n    }\n    return details;\n  };\n\n  Logger.prototype.makeABox = function(message, title) {\n    var j, l, len, len1, len2, line, lines, separator, topLine;\n    if (!_.isArray(message)) {\n      message = message.split(\"\\n\");\n    }\n    len = 0;\n    for (j = 0, len1 = message.length; j < len1; j++) {\n      line = message[j];\n      len = Math.max(len, line.length);\n    }\n    topLine = \"+--\" + s.pad('', len, '-') + \"--+\";\n    separator = \"|  \" + s.pad('', len, '') + \"  |\";\n    lines = [];\n    lines.push(topLine);\n    if (title != null) {\n      lines.push(\"|  \" + s.lrpad(title, len) + \"  |\");\n      lines.push(topLine);\n    }\n    lines.push(separator);\n    for (l = 0, len2 = message.length; l < len2; l++) {\n      line = message[l];\n      lines.push(\"|  \" + s.rpad(line, len) + \"  |\");\n    }\n    lines.push(separator);\n    lines.push(topLine);\n    return lines;\n  };\n\n  Logger.prototype._log = function(options) {\n    var box, color, j, len1, line, prefix, subPrefix;\n    if (LoggerManager.enabled === false) {\n      LoggerManager.addToQueue(this, arguments);\n      return;\n    }\n    if (options.level == null) {\n      options.level = 1;\n    }\n    if (LoggerManager.logLevel < options.level) {\n      return;\n    }\n    prefix = this.getPrefix(options);\n    if (options.box === true && _.isString(options[\"arguments\"][0])) {\n      color = void 0;\n      if (this.defaultTypes[options.type] != null) {\n        color = this.defaultTypes[options.type].color;\n      }\n      box = this.makeABox(options[\"arguments\"][0], options[\"arguments\"][1]);\n      subPrefix = '➔';\n      if (color != null) {\n        subPrefix = subPrefix[color];\n      }\n      console.log(subPrefix, prefix);\n      for (j = 0, len1 = box.length; j < len1; j++) {\n        line = box[j];\n        if (color != null) {\n          console.log(subPrefix, line[color]);\n        } else {\n          console.log(subPrefix, line);\n        }\n      }\n    } else {\n      options[\"arguments\"].unshift(prefix);\n      console.log.apply(console, options[\"arguments\"]);\n    }\n  };\n\n  return Logger;\n\n})();\n\nthis.SystemLogger = new Logger('System', {\n  methods: {\n    startup: {\n      type: 'success',\n      level: 0\n    }\n  }\n});\n\nprocessString = function(string, date) {\n  if (string[0] === '{') {\n    try {\n      return Log.format(EJSON.parse(string), {\n        color: true\n      });\n    } catch (error) {}\n  }\n  try {\n    return Log.format({\n      message: string,\n      time: date,\n      level: 'info'\n    }, {\n      color: true\n    });\n  } catch (error) {}\n  return string;\n};\n\nStdOut = new ((function(superClass) {\n  extend(_Class, superClass);\n\n  function _Class() {\n    var write;\n    this.queue = [];\n    write = process.stdout.write;\n    process.stdout.write = (function(_this) {\n      return function(string, encoding, fd) {\n        var date, item, ref, ref1, viewLimit;\n        write.apply(process.stdout, arguments);\n        date = new Date;\n        string = processString(string, date);\n        item = {\n          id: Random.id(),\n          string: string,\n          ts: date\n        };\n        _this.queue.push(item);\n        viewLimit = (ref = Meteor.settings) != null ? (ref1 = ref.logger) != null ? ref1.viewLimit : void 0 : void 0;\n        if (!viewLimit) {\n          viewLimit = 1000;\n        }\n        if (_this.queue.length > viewLimit) {\n          _this.queue.shift();\n        }\n        return _this.emit('write', string, item);\n      };\n    })(this);\n  }\n\n  return _Class;\n\n})(EventEmitter));\n\nMeteor.publish('stdout', function() {\n  var item, j, len1, ref, user;\n  if (!this.userId) {\n    return this.ready();\n  }\n  if (!this.userId) {\n    return this.ready();\n  }\n  user = db.users.findOne(this.userId, {\n    fields: {\n      is_cloudadmin: 1\n    }\n  });\n  if (!user) {\n    return this.ready();\n  }\n  ref = StdOut.queue;\n  for (j = 0, len1 = ref.length; j < len1; j++) {\n    item = ref[j];\n    this.added('stdout', item.id, {\n      string: item.string,\n      ts: item.ts\n    });\n  }\n  this.ready();\n  StdOut.on('write', (function(_this) {\n    return function(string, item) {\n      return _this.added('stdout', item.id, {\n        string: item.string,\n        ts: item.ts\n      });\n    };\n  })(this));\n});\n\nMeteor.startup(function() {\n  var ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7;\n  if ((ref = Meteor.settings) != null ? (ref1 = ref.logger) != null ? ref1.enabled : void 0 : void 0) {\n    if ((ref2 = Meteor.settings) != null ? (ref3 = ref2.logger) != null ? ref3.showPackage : void 0 : void 0) {\n      LoggerManager.showPackage = true;\n    }\n    if ((ref4 = Meteor.settings) != null ? (ref5 = ref4.logger) != null ? ref5.showFileAndLine : void 0 : void 0) {\n      LoggerManager.showFileAndLine = true;\n    }\n    if ((ref6 = Meteor.settings) != null ? (ref7 = ref6.logger) != null ? ref7.logLevel : void 0 : void 0) {\n      LoggerManager.logLevel = Meteor.settings.logger.logLevel;\n    }\n    return LoggerManager.enable(true);\n  }\n});\n"]}